# üõ†Ô∏è Proofport Backend ‚Äì Automated Verifier Deployment System

## Overview

This `backend` module offers a fully automated pipeline for compiling Noir circuits, generating verification keys (VKs), and deploying verifiers to both **Ethereum (via Anvil)** and **Starknet (via starknet-devnet)**. It concludes by updating a unified `verifier_registry.json` for circuit discovery and integration.

The centerpiece of this system is its integration with **Garaga**, a Starknet-native toolchain. It enables seamless generation of Cairo verifier projects from existing VKs, making this setup ideal for **multi-chain ZK proof deployments** across EVM and Starknet ecosystems.

---

## Capabilities

### 1. Compile Noir Circuits

* Uses `nargo compile` to generate intermediate `.json` artifacts.

### 2. Generate Verification Key (VK)

* Via Barretenberg's `bb write_vk`, generating keys used for proving and verification.

### 3. Dual Verifier Generation (Solidity & Cairo)

* `bb write_solidity_verifier` creates the EVM-compatible `Verifier.sol`.
* **`garaga gen`** generates a complete Starknet-compatible verifier contract in Cairo.
  ‚Üí **Built-in Starknet support via Garaga** enables streamlined Cairo verifier generation.

### 4. Local Deployment Setup

* **Ethereum (Anvil)**: Run with `--code-size-limit 50000` to bypass verifier size limits.
* **Starknet (Devnet)**: Launched via `starknet-devnet --accounts=2 --seed=0 --initial-balance=1e23`.

### 5. Automatic Contract Declaration & Deployment

* EVM: `forge create` handles deployment.
* Starknet: `sncast declare` + `sncast deploy` used for verifier rollout.

### 6. Unified Registry Update

* Registry file (`verifier_registry.json`) is updated with:

  * Circuit metadata (ID, description, public inputs, Noir version, hash)
  * EVM address and Starknet class hash
  * Deployment timestamps per chain

---

## How to Use

### 1. Prerequisites

```bash
# .env setup (used for Anvil deployment)
PRIVATE_KEY=0x<your-local-anvil-private-key>

# Run Starknet devnet
starknet-devnet --accounts=2 --seed=0 --initial-balance=100000000000000000000000

# Run Anvil (disable contract size check)
anvil --code-size-limit 50000
```

### 2. Run the deployment pipeline

```bash
cd operator/backend

# Replace with your circuit folder name
node src/build-and-deploy.mjs group-membership
```

This single command performs all the following steps:

1. Compile circuit (`nargo compile`)
2. Generate verification key (`bb write_vk`)
3. Generate Solidity and Cairo verifiers (via `bb` and `garaga`)
4. Deploy to EVM (Anvil) via `forge`
5. Declare and deploy to Starknet (via `sncast`)
6. Update `verifier_registry.json` with metadata
7. Clean build artifacts

---

## Current Limitations & Future Plans

### Contract Size Limit

* Current verifiers generated by Barretenberg are too large for deployment on **public testnets**.
* We currently support **devnet-only deployment**.
* **Once Barretenberg introduces optimized verifier code**, testnet/mainnet deployment will be feasible.

---

## Technical Merit: Garaga Integration

This project showcases a modern ZK infrastructure using the following toolchain:

**Noir ‚Üí Barretenberg ‚Üí Garaga ‚Üí EVM & Starknet Verifiers**

By leveraging **Garaga**, the official verifier generator endorsed, this system:

* Enables **automated Cairo verifier generation** directly from VKs.
* Bridges **cross-chain ZK proof systems** by supporting both Solidity and Cairo.
* Demonstrates a **scalable architecture for future-proof ZK applications**, where developers can reuse the same Noir logic and deploy to multiple chains with minimal overhead.

Such a pipeline represents **best practices for multi-chain ZK interoperability**, automation, and modular zkApp development. This architectural approach can serve as a reference implementation for real-world applications aiming to scale across chains.

---

## üìÅ Directory Layout (Simplified)

```
packages/
  circuits/
    group-membership/
      target/              # Compiled circuit artifacts
      verifier/            # Starknet verifier project generated by Garaga
      accounts.json        # Local devnet account info

packages/registry/
  verifier_registry.json   # Final registry file with metadata + chain info
```
